general:
  artifacts:

## Customize dependencies
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install bc libfuse-dev libarchive-dev xfsprogs valgrind
    - cd .. && git clone git://github.com/libos-nuse/buildrump.sh
    - cd ../buildrump.sh && git checkout linux-libos && ./buildrump.sh checkout

  post:
    - cd ../buildrump.sh && ./buildrump.sh -l ../lkl-linux -o obj -d rump -qq -j16 fullbuild 

test:
  override:
    # skip for a while: test was done by buildrump.sh
    - cd tools/lkl
    #- cd tools/lkl && make test
    - ? >
        if [ -n "${RUN_NIGHTLY_BUILD}" ]; then
          cd tools/lkl && make valgrind;
        fi
      : timeout: 1800 # timeout to 30mins

  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find ./tools/lkl/ -type f -name "*.xml" -exec cp {} $CIRCLE_TEST_REPORTS/ \;
